@model CarDealership.Models.Car
@using CarDealership.Data
@using Microsoft.AspNetCore.Identity
@inject ApplicationDbContext Db
@inject UserManager<CarDealership.Models.ApplicationUser> UserManager

@{
    ViewData["Title"] = "Детайли";

    var userId = User.Identity?.IsAuthenticated == true ? UserManager.GetUserId(User) : null;

    var isFav = false;
    if (!string.IsNullOrWhiteSpace(userId))
    {
        isFav = Db.Favorites.Any(f => f.UserId == userId && f.CarId == Model.Id);
    }

    string BgFuel(string v) => v switch
    {
        "Petrol" => "Бензин",
        "Diesel" => "Дизел",
        "Hybrid" => "Хибрид",
        "Electric" => "Електрическа",
        _ => v
    };

    string BgTransmission(string v) => v switch
    {
        "Manual" => "Ръчна",
        "Automatic" => "Автоматична",
        _ => v
    };
}

<div class="container py-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
            <h1 class="h4 mb-0">Детайли</h1>
            <div class="text-muted">@Model.Brand @Model.Model</div>
        </div>

        @if (User.Identity?.IsAuthenticated == true)
        {
            <form asp-controller="Favorites" asp-action="Toggle" method="post" class="m-0">
                @Html.AntiForgeryToken()
                <input type="hidden" name="carId" value="@Model.Id" />
                <input type="hidden" name="returnUrl" value="@Context.Request.Path@Context.Request.QueryString" />

                @if (isFav)
                {
                    <button type="submit" class="btn btn-outline-danger">
                        ?? Премахни от любими
                    </button>
                }
                else
                {
                    <button type="submit" class="btn btn-outline-danger">
                        ?? Добави в любими
                    </button>
                }
            </form>
        }
        else
        {
            <a asp-area="Identity" asp-page="/Account/Login" class="btn btn-outline-secondary">
                Влез, за да добавиш в любими
            </a>
        }
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-4 col-lg-3">Марка</dt>
                <dd class="col-sm-8 col-lg-9">@Model.Brand</dd>

                <dt class="col-sm-4 col-lg-3">Модел</dt>
                <dd class="col-sm-8 col-lg-9">@Model.Model</dd>

                <dt class="col-sm-4 col-lg-3">Година</dt>
                <dd class="col-sm-8 col-lg-9">@Model.Year</dd>

                <dt class="col-sm-4 col-lg-3">Описание</dt>
                <dd class="col-sm-8 col-lg-9">@Model.Description</dd>

                <dt class="col-sm-4 col-lg-3">Километраж</dt>
                <dd class="col-sm-8 col-lg-9">@Model.Mileage km</dd>

                <dt class="col-sm-4 col-lg-3">Двигател</dt>
                <dd class="col-sm-8 col-lg-9">@Model.Engine</dd>

                <dt class="col-sm-4 col-lg-3">Мощност</dt>
                <dd class="col-sm-8 col-lg-9">@Model.HorsePower к.с.</dd>

                <dt class="col-sm-4 col-lg-3">Гориво</dt>
                <dd class="col-sm-8 col-lg-9">@BgFuel(Model.FuelType)</dd>

                <dt class="col-sm-4 col-lg-3">Скоростна кутия</dt>
                <dd class="col-sm-8 col-lg-9">@BgTransmission(Model.Transmission)</dd>

                <dt class="col-sm-4 col-lg-3">Тип</dt>
                <dd class="col-sm-8 col-lg-9">@Model.Type</dd>

                <dt class="col-sm-4 col-lg-3">Цена за продажба</dt>
                <dd class="col-sm-8 col-lg-9">@Model.SalePrice €</dd>

                <dt class="col-sm-4 col-lg-3">Цена за наем (ден)</dt>
                <dd class="col-sm-8 col-lg-9">@Model.RentPricePerDay €</dd>

                <dt class="col-sm-4 col-lg-3">Статус</dt>
                <dd class="col-sm-8 col-lg-9">@Model.Status</dd>
            </dl>
        </div>
    </div>

    <div class="d-flex gap-2 mt-3">
        <a class="btn btn-outline-primary" asp-action="Edit" asp-route-id="@Model.Id">Редакция</a>
        <a class="btn btn-outline-secondary" asp-action="Index">Назад към списъка</a>
    </div>
</div>
